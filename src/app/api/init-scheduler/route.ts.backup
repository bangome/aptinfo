/**
 * ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™” API ì—”ë“œí¬ì¸íŠ¸
 * ì„œë²„ ì‹œì‘ ì‹œ ë˜ëŠ” ìˆ˜ë™ìœ¼ë¡œ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì´ˆê¸°í™”
 */

import { NextResponse } from 'next/server';
import { initializeAppScheduler, getSchedulerStatus } from '@/lib/scheduler-init';
import { normalizeError, logError } from '@/lib/error-handling';

/**
 * ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™” ìƒíƒœ í™•ì¸
 */
export async function GET() {
  try {
    const status = getSchedulerStatus();
    
    return NextResponse.json({
      success: true,
      data: status,
      message: 'ìŠ¤ì¼€ì¤„ëŸ¬ ìƒíƒœë¥¼ ì¡°íšŒí–ˆìŠµë‹ˆë‹¤',
      timestamp: new Date().toISOString()
    });
    
  } catch (error) {
    const normalizedError = normalizeError(error);
    logError(normalizedError, { endpoint: '/api/init-scheduler', method: 'GET' });
    
    return NextResponse.json({
      success: false,
      error: normalizedError.userMessage,
      code: normalizedError.code
    }, { status: 500 });
  }
}

/**
 * ìŠ¤ì¼€ì¤„ëŸ¬ ìˆ˜ë™ ì´ˆê¸°í™”
 */
export async function POST() {
  try {
    console.log('ğŸ”„ ìŠ¤ì¼€ì¤„ëŸ¬ ìˆ˜ë™ ì´ˆê¸°í™” ìš”ì²­ ë°›ìŒ');
    
    await initializeAppScheduler();
    
    const status = getSchedulerStatus();
    
    return NextResponse.json({
      success: true,
      data: status,
      message: 'ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì„±ê³µì ìœ¼ë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤',
      timestamp: new Date().toISOString()
    });
    
  } catch (error) {
    const normalizedError = normalizeError(error);
    logError(normalizedError, { endpoint: '/api/init-scheduler', method: 'POST' });
    
    return NextResponse.json({
      success: false,
      error: normalizedError.userMessage,
      code: normalizedError.code,
      message: 'ìŠ¤ì¼€ì¤„ëŸ¬ ì´ˆê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤'
    }, { status: 500 });
  }
}